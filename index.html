<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AETERNUM // GATEWAY</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #66fcf1; --bg-void: #050505; }
        body { background-color: var(--bg-void); color: #e0e7ff; font-family: 'Space Mono', monospace; overflow: hidden; }

        /* VISUALS */
        .scanline {
            width: 100%; height: 100px; z-index: 10;
            background: linear-gradient(0deg, rgba(0,0,0,0) 0%, rgba(102, 252, 241, 0.03) 50%, rgba(0,0,0,0) 100%);
            opacity: 0.1; position: absolute; bottom: 100%;
            animation: scanline 10s linear infinite; pointer-events: none;
        }
        @keyframes scanline { 0% { bottom: 100%; } 100% { bottom: -100%; } }
        .flicker { animation: flicker 3s infinite; }
        @keyframes flicker { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } 52% { opacity: 0.2; } 54% { opacity: 1; } }

        .input-glass { background: rgba(20, 20, 30, 0.6); border: 1px solid #334155; color: #fff; transition: 0.3s; }
        .input-glass:focus { outline: none; border-color: var(--accent); background: rgba(20, 20, 30, 0.9); box-shadow: 0 0 15px rgba(102, 252, 241, 0.1); }
        
        .btn-entry {
            background: rgba(102, 252, 241, 0.1); color: var(--accent); border: 1px solid var(--accent);
            font-weight: bold; transition: 0.3s; cursor: pointer;
        }
        .btn-entry:hover { background: var(--accent); color: #000; box-shadow: 0 0 25px rgba(102, 252, 241, 0.6); }
        .loader-bar { width: 0%; height: 2px; background: var(--accent); transition: width 1s ease-in-out; }
    </style>
</head>
<body class="flex items-center justify-center h-screen relative">

    <div class="scanline"></div>
    <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-30"></div>

    <div class="z-20 w-full max-w-sm p-8 border border-white/5 bg-black/40 backdrop-blur-md rounded-xl shadow-2xl relative">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold tracking-[0.2em] text-white flicker">AETERNUM</h1>
            <p class="text-[10px] text-gray-500 tracking-widest mt-2">GATEWAY ONLINE</p>
        </div>

        <div id="login-form" class="space-y-5">
            <div>
                <label class="block text-[10px] text-[#66fcf1] uppercase mb-1 tracking-widest">Identity_String</label>
                <input type="text" id="handle" placeholder="ENTER HANDLE..." autocomplete="off" class="w-full p-3 rounded input-glass text-sm tracking-wide uppercase">
            </div>
            <div>
                <label class="block text-[10px] text-gray-500 uppercase mb-1 tracking-widest">Access_Key</label>
                <input type="password" id="password" placeholder="••••••••" class="w-full p-3 rounded input-glass text-sm tracking-widest">
            </div>
            <button id="btn-login" class="w-full py-3 rounded btn-entry text-xs tracking-[0.2em] mt-2">INITIALIZE_LINK</button>
        </div>

        <div id="loader" class="hidden space-y-4 text-center py-4">
            <div class="text-xs text-[#66fcf1] font-bold animate-pulse">PROCESSING...</div>
            <div class="w-full bg-gray-900 h-0.5 rounded overflow-hidden">
                <div id="progress" class="loader-bar"></div>
            </div>
            <div class="text-[10px] text-gray-500 font-mono text-left space-y-1 h-20 overflow-auto" id="console-log">
                > System Ready.<br>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

        // ==========================================
        //  PASTE YOUR FIREBASE CONFIG KEYS HERE
        // ==========================================
        const firebaseConfig = {
  apiKey: "AIzaSyATfSwTh7nQ-1HAE1iarmp-K6GoKkboEbc",
  authDomain: "aeternum-840dd.firebaseapp.com",
  projectId: "aeternum-840dd",
  storageBucket: "aeternum-840dd.firebasestorage.app",
  messagingSenderId: "409417083922",
  appId: "1:409417083922:web:fc33d26814a7d7e86bfccb",
  measurementId: "G-TDJQLYF4S4"
};
        // ==========================================

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Define Login Function
        async function attemptLogin() {
            const handleInput = document.getElementById('handle');
            const handle = handleInput.value.trim().toUpperCase();
            const form = document.getElementById('login-form');
            const loader = document.getElementById('loader');
            const prog = document.getElementById('progress');
            const logs = document.getElementById('console-log');

            if(!handle) {
                handleInput.style.borderColor = "red";
                setTimeout(() => handleInput.style.borderColor = "#334155", 500);
                return;
            }

            // Start UI Transition
            form.classList.add('hidden');
            loader.classList.remove('hidden');
            logs.innerHTML += `> Identity: ${handle}<br>`;

            try {
                // 1. Authenticate
                logs.innerHTML += "> Handshaking...<br>";
                const userCredential = await signInAnonymously(auth);
                const user = userCredential.user;
                prog.style.width = "40%";
                logs.innerHTML += `> Uplink: [${user.uid.slice(0,5)}...]<br>`;

                // 2. Check/Create Profile
                const userRef = doc(db, "users", user.uid);
                const userSnap = await getDoc(userRef);
                prog.style.width = "80%";

                if (!userSnap.exists()) {
                    logs.innerHTML += "> New Entity. Registering...<br>";
                    await setDoc(userRef, {
                        handle: handle,
                        status: "ONLINE",
                        joinedAt: new Date()
                    });
                } else {
                    logs.innerHTML += `> Welcome back, ${userSnap.data().handle}.<br>`;
                }

                // 3. Success
                prog.style.width = "100%";
                logs.innerHTML += "> <span style='color:#66fcf1'>ACCESS GRANTED.</span>";
                
                setTimeout(() => {
                    window.location.href = "dashboard.html";
                }, 1000);

            } catch (error) {
                console.error("Login Error:", error);
                prog.style.backgroundColor = "red";
                logs.innerHTML += `<br><span style="color:red">ERR: ${error.message}</span>`;
                logs.innerHTML += `<br><span style="color:gray">Check Config Keys!</span>`;
                
                // Reset UI after 4s
                setTimeout(() => {
                    form.classList.remove('hidden');
                    loader.classList.add('hidden');
                    prog.style.width = "0%";
                    prog.style.backgroundColor = "#66fcf1";
                }, 4000);
            }
        }

        // Attach Button Listener
        document.getElementById('btn-login').addEventListener('click', attemptLogin);
        document.getElementById('handle').addEventListener('keypress', (e) => { if(e.key==='Enter') attemptLogin() });
        document.getElementById('password').addEventListener('keypress', (e) => { if(e.key==='Enter') attemptLogin() });

    </script>
</body>
</html>